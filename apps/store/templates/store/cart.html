{% extends "core/base.html" %}
{% load humanize %}
{% load i18n %}

{% block page_content %}
    <div class="page-content">
        <div class="cart">
            <div class="container">
                <div class="row">
                    <div class="col-lg-9">
                        <table class="table table-cart table-mobile">
                            <thead>
                            <tr>
                                <th>محصول</th>
                                <th>قیمت</th>
                                <th>تعداد</th>
                                <th>مجموع</th>
                                <th></th>
                            </tr>
                            </thead>

                            <tbody>
                            <tr>
                                <td class="product-col">
                                    <div class="product">
                                        <figure class="product-media">
                                            <a href="#">
                                                <img src="assets/images/products/table/product-1.jpg" alt="تصویر محصول">
                                            </a>
                                        </figure>

                                        <h3 class="product-title">
                                            <a href="#">کتونی ورزشی مخصوص دویدن رنگ بژ</a>
                                        </h3><!-- End .product-title -->
                                    </div><!-- End .product -->
                                </td>
                                <td class="price-col">84,000</td>
                                <td class="quantity-col">
                                    <div class="cart-product-quantity">
                                        <div class="input-group  input-spinner">
                                            <input type="number" class="form-control" value="1" min="1" max="10"
                                                   step="1"
                                                   data-decimals="0" required="">
                                        </div>
                                    </div><!-- End .cart-product-quantity -->
                                </td>
                                <td class="total-col">84,000</td>
                                <td class="remove-col">
                                    <button class="btn-remove"><i class="icon-close"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td class="product-col">
                                    <div class="product">
                                        <figure class="product-media">
                                            <a href="#">
                                                <img src="assets/images/products/table/product-2.jpg" alt="تصویر محصول">
                                            </a>
                                        </figure>

                                        <h3 class="product-title">
                                            <a href="#">لباس زنانه آبی</a>
                                        </h3><!-- End .product-title -->
                                    </div><!-- End .product -->
                                </td>
                                <td class="price-col">76,000</td>
                                <td class="quantity-col">
                                    <div class="cart-product-quantity">
                                        <div class="input-group  input-spinner">
                                            <input type="number" class="form-control" value="1" min="1" max="10"
                                                   step="1"
                                                   data-decimals="0" required="">
                                        </div>
                                    </div><!-- End .cart-product-quantity -->
                                </td>
                                <td class="total-col">152,000</td>
                                <td class="remove-col">
                                    <button class="btn-remove"><i class="icon-close"></i></button>
                                </td>
                            </tr>
                            </tbody>
                        </table><!-- End .table table-wishlist -->

                        <div class="cart-bottom">
                            <div class="cart-discount">
                                <form action="#">
                                    <div class="input-group">
                                        <input type="text" class="form-control" required="" placeholder="کد تخفیف">
                                        <div class="input-group-append">
                                            <button class="btn btn-outline-primary-2" type="submit"><i
                                                    class="icon-long-arrow-left"></i></button>
                                        </div><!-- .End .input-group-append -->
                                    </div><!-- End .input-group -->
                                </form>
                            </div><!-- End .cart-discount -->

                            <a href="#" class="btn btn-outline-dark-2"><span>به روز رسانی سبد خرید</span><i
                                    class="icon-refresh"></i></a>
                        </div><!-- End .cart-bottom -->
                    </div><!-- End .col-lg-9 -->
                    <aside class="col-lg-3">
                        <div class="summary summary-cart">
                            <h3 class="summary-title">جمع سبد خرید</h3><!-- End .summary-title -->

                            <table class="table table-summary">
                                <tbody>
                                <tr class="summary-subtotal">
                                    <td>جمع کل سبد خرید :</td>
                                    <td class="text-left">236,000 تومان</td>
                                </tr><!-- End .summary-subtotal -->
                                <tr class="summary-shipping">
                                    <td>شیوه ارسال :</td>
                                    <td>&nbsp;</td>
                                </tr>

                                <tr class="summary-shipping-row">
                                    <td>
                                        <div class="custom-control custom-radio">
                                            <input type="radio" id="free-shipping" name="shipping"
                                                   class="custom-control-input">
                                            <label class="custom-control-label" for="free-shipping">ارسال
                                                رایگان</label>
                                        </div><!-- End .custom-control -->
                                    </td>
                                    <td class="text-left">0,000 تومان</td>
                                </tr><!-- End .summary-shipping-row -->

                                <tr class="summary-shipping-row">
                                    <td>
                                        <div class="custom-control custom-radio">
                                            <input type="radio" id="standart-shipping" name="shipping"
                                                   class="custom-control-input">
                                            <label class="custom-control-label" for="standart-shipping">پست
                                                سفارشی :</label>
                                        </div><!-- End .custom-control -->
                                    </td>
                                    <td class="text-left">10,000 تومان</td>
                                </tr><!-- End .summary-shipping-row -->

                                <tr class="summary-shipping-row">
                                    <td>
                                        <div class="custom-control custom-radio">
                                            <input type="radio" id="express-shipping" name="shipping"
                                                   class="custom-control-input">
                                            <label class="custom-control-label" for="express-shipping">پست
                                                پیشتاز :</label>
                                        </div><!-- End .custom-control -->
                                    </td>
                                    <td class="text-left">20,000 تومان</td>
                                </tr><!-- End .summary-shipping-row -->

                                <tr class="summary-shipping-estimate">
                                    <td>آدرس<br> <a href="dashboard.html">تغییر آدرس</a></td>
                                    <td>&nbsp;</td>
                                </tr><!-- End .summary-shipping-estimate -->

                                <tr class="summary-total">
                                    <td>مبلغ قابل پرداخت :</td>
                                    <td class="text-left">236,000 تومان</td>
                                </tr><!-- End .summary-total -->
                                </tbody>
                            </table><!-- End .table table-summary -->

                            <a href="checkout.html" class="btn btn-outline-primary-2 btn-order btn-block">رفتن
                                به صفحه پرداخت</a>
                        </div><!-- End .summary -->

                        <a href="category.html" class="btn btn-outline-dark-2 btn-block mb-3"><span>ادامه
                                        خرید</span><i class="icon-refresh"></i></a>
                    </aside><!-- End .col-lg-3 -->
                </div><!-- End .row -->
            </div><!-- End .container -->
        </div><!-- End .cart -->
    </div>
{% endblock %}
{% block content %}
    {% if request.cart.has_item %}
        <div id="page-top" class="wide">
            <table class="table">
                <thead>
                <tr>
                    <th scope="col"></th>
                    <th scope="col" style="width: 70%">عنوان</th>
                    <th scope="col" style="width: auto">تاریخ ثبت نام</th>
                    <th scope="col" style="width: 140px; text-align: center;">لینک</th>
                </tr>
                </thead>
                <tbody>
                {% for item in request.cat.cartitem_set %}
                    <tr>
                        <th scope="row">1</th>
                        <td>{{ item.product.title }}</td>
                        <td>01.01.1401</td>
                        <td>
                            <button type="button" class="btn btn-outline-primary btn-equal">مشاهده</button>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            <br> <br>

            <br> <br> <br>
            اگر بشه ستون های سوم و چهارم که تاریخ و دکمه هستن، متنهاشون وسط چین بشن.
        </div>
        <table class="table" id="cart-table">
            <thead>
            <tr>
                <th scope="col">سطر</th>
                <th scope="col">نام کالا</th>
                <th scope="col">قیمت</th>
                <th scope="col">تعداد</th>
                <th scope="col">تغییر تعداد</th>
                <th scope="col">حذف</th>
            </tr>
            </thead>
            <tbody>
            {% for item in request.cart.cartitem_set.all %}
                <tr id="row{{ forloop.counter }}">
                    <th scope="row">{{ forloop.counter }}</th>
                    <td>{{ item.product.title }}</td>
                    <td>{{ item.product.price |floatformat:"0" |intcomma }}</td>
                    <td>{{ item.quantity }}</td>
                    <td>
                        <form autocomplete=off method="post"
                                {#                                      action="{% url 'store:cart_item' item.id %}"#}
                        >
                            {% csrf_token %}
                            <input type="text" name="product" value="{{ item.product.pk }}" hidden>
                            <input type="text" name="request_type" value="dec" hidden>
                            <input type="number" name="quantity" value="1" hidden>
                            <input type="submit" value="Dec">
                        </form>

                        <form autocomplete=off method="post"
                                {#                                      action="{% url 'store:cart_item' item.id %}"#}
                        >
                            {% csrf_token %}
                            <input type="text" name="product" value="{{ item.product.pk }}" hidden>
                            <input type="text" name="request_type" value="inc" hidden>
                            <input type="number" name="quantity" value="1" hidden>
                            <input type="submit" value="Inc">
                        </form>


                    </td>
                    <td>
                        <button id="delete{{ forloop.counter }}">delete</button>
                        <script>
                            $("#delete{{ forloop.counter }}").click(function () {
                                $.ajax({
                                    type: "DELETE",
                                    {#url: '{% url 'store:cart_item'  item.id %}',#}
                                    beforeSend: function (xhr) {
                                        xhr.setRequestHeader("X-CSRFToken", getCookie("csrftoken"));
                                    },
                                    success: function (data) {
                                        console.log("success");
                                        $('#row{{ forloop.counter }}').remove();
                                    },
                                    error: function (data) {
                                        alertify.error('{% translate "error in response" %}');
                                    },

                                });
                            });
                        </script>
                    </td>
                </tr>
            {% endfor %}
            </tbody>

        </table>
        <br>
        <h1>جمع کل {{ cart_sum |floatformat:"0" |intcomma }}</h1>
        <form autocomplete=off method="post"
                {#                      action="{% url 'store:payments' %}"#}
        >
            {% csrf_token %}
            <input type="submit" value="{% trans 'Pay Order' %}">
        </form>
    {% else %}
        <h1>{% trans "your cart is empty" %}</h1>
    {% endif %}
    {% for post in page_obj %}

    {% endfor %}
{% endblock %}